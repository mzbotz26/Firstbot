from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes
from config import BOT_TOKEN, ADMIN_ID

# рдПрдбрдорд┐рди рдХреА рдСрдирд▓рд╛рдЗрди рд╕реНрдерд┐рддрд┐ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рддрд░реАрдХрд╛
# рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдПрдбрдорд┐рди рд▓реЙрдЧ-рдЗрди рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдзрд┐рдХ рдЙрдиреНрдирдд рддрдВрддреНрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред
admin_online = False 

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """/start рдХрдорд╛рдВрдб рдкрд░ рдпреВрдЬрд░ рдХреЛ рдЬрд╡рд╛рдм рджреЗрддрд╛ рд╣реИред"""
    user_name = update.message.from_user.first_name
    
    if admin_online:
        # рдЕрдЧрд░ рдПрдбрдорд┐рди рдСрдирд▓рд╛рдЗрди рд╣реИ, рддреЛ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрд╡рд╛рдЧрдд рд╕рдВрджреЗрд╢ рднреЗрдЬреЗрдВред
        await update.message.reply_text(f'рдирдорд╕реНрддреЗ {user_name}! рдПрдбрдорд┐рди рдЕрднреА **рдСрдирд▓рд╛рдЗрди** рд╣реИрдВред рдЖрдк рдЕрдкрдирд╛ рдореИрд╕реЗрдЬ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред')
    else:
        # рдЕрдЧрд░ рдПрдбрдорд┐рди рдСрдирд▓рд╛рдЗрди рдирд╣реАрдВ рд╣реИ, рддреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЬрд╡рд╛рдм рднреЗрдЬреЗрдВред
        await update.message.reply_text(
            f'рдирдорд╕реНрддреЗ {user_name}! ЁЯШК\n\n'
            '**рдХреНрд╖рдорд╛ рдХрд░реЗрдВ, рдПрдбрдорд┐рди рдЕрднреА рдСрдирд▓рд╛рдЗрди рдирд╣реАрдВ рд╣реИрдВред** '
            'рдСрдирд▓рд╛рдЗрди рдЖрддреЗ рд╣реА рд╡рд╣ рдЖрдкрдХреЛ **рдЬрд▓реНрдж рд╣реА рдореИрд╕реЗрдЬ** рдХрд░реЗрдВрдЧреЗред\n\n'
            'рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдЕрдкрдиреА рдмрд╛рдд рдпрд╣рд╛рдБ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рд╣ рдмрд╛рдж рдореЗрдВ рджреЗрдЦреЗрдВрдЧреЗред'
        )

async def message_admin_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    рдПрдбрдорд┐рди рдХреА рдСрдирд▓рд╛рдЗрди рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдХрдорд╛рдВрдбред 
    рдЗрд╕реЗ рдХреЗрд╡рд▓ рдПрдбрдорд┐рди рд╣реА рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
    """
    global admin_online
    
    # рдпрд╣ рдЪреЗрдХ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХрдорд╛рдВрдб рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╡реНрдпрдХреНрддрд┐ рдПрдбрдорд┐рди рд╣реИ рдпрд╛ рдирд╣реАрдВред
    if update.effective_user.id != ADMIN_ID:
        await update.message.reply_text("рдорд╛рдл рдХрд░реЗрдВ, рдЖрдк рдпрд╣ рдХрдорд╛рдВрдб рдЗрд╕реНрддреЗрдорд╛рд▓ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред")
        return
    
    # рдХрдорд╛рдВрдб рдХреЗ рдмрд╛рдж рдХрд╛ рддрд░реНрдХ (argument) рд▓реЗрддрд╛ рд╣реИ, рдЬреИрд╕реЗ /message_admin online
    if not context.args or context.args[0].lower() not in ['online', 'offline']:
        await update.message.reply_text("рдХреГрдкрдпрд╛ рд╕рд╣реА рд╕реНрдерд┐рддрд┐ рдмрддрд╛рдПрдВ: /message_admin online рдпрд╛ /message_admin offline")
        return

    new_status = context.args[0].lower()
    
    if new_status == 'online' and not admin_online:
        admin_online = True
        await update.message.reply_text("тЬЕ рдПрдбрдорд┐рди рдЕрдм **рдСрдирд▓рд╛рдЗрди** рд╣реИрдВ! рд╕рднреА рдпреВрдЬрд░реНрд╕ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред")
        
        # рд╕рднреА рдпреВрдЬрд░реНрд╕ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдпреВрдЬрд░ IDs рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдЬреЛ рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИ)ред
        # рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рдмрд╕ рдПрдбрдорд┐рди рдХреЛ рдХрдиреНрдлрд░реНрдо рдХрд░рддрд╛ рд╣реИред
        
    elif new_status == 'offline' and admin_online:
        admin_online = False
        await update.message.reply_text("тЭМ рдПрдбрдорд┐рди рдЕрдм **рдСрдлрд▓рд╛рдЗрди** рд╣реИрдВред")

    elif new_status == 'online' and admin_online:
        await update.message.reply_text("рдПрдбрдорд┐рди рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдСрдирд▓рд╛рдЗрди рд╣реИрдВред")

    elif new_status == 'offline' and not admin_online:
        await update.message.reply_text("рдПрдбрдорд┐рди рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдСрдлрд▓рд╛рдЗрди рд╣реИрдВред")


def main() -> None:
    """рдмреЙрдЯреНрд╕ рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХрд╛ рдореБрдЦреНрдп рдлрдВрдХреНрд╢рдиред"""
    
    # Application рдмрд┐рд▓реНрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреЙрдЯ рдПрдкреНрд▓реАрдХреЗрд╢рди рдмрдирд╛рдПрдВред
    application = Application.builder().token(BOT_TOKEN).build()
    
    # рдХрдорд╛рдВрдб рд╣реИрдВрдбрд▓рд░реНрд╕ рдЬреЛрдбрд╝реЗрдВ
    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("message_admin", message_admin_command))

    # рдмреЙрдЯ рдХреЛ рдкреЛрд▓рд┐рдВрдЧ рдореЛрдб рдореЗрдВ рд╢реБрд░реВ рдХрд░реЗрдВ (рдЬреЛ рд▓рдЧрд╛рддрд╛рд░ рдирдП рдореИрд╕реЗрдЬ рдХреЗ рд▓рд┐рдП рдЪреЗрдХ рдХрд░рддрд╛ рд╣реИ)
    print("Bot is running...")
    application.run_polling(allowed_updates=Update.ALL_TYPES)


if __name__ == "__main__":
    main()
    
